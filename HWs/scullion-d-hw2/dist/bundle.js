(()=>{"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var e,n,r,o,i,a,s,c=Object.freeze({gain:.5,numSamples:256}),l=(new Uint8Array(c.numSamples/2),function(t){n.src=t});function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==u(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===u(o)?o:String(o)),r)}var o}function f(t,e,n){return e&&h(t.prototype,e),n&&h(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var y=f((function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=n,this.z=r,this.trueY=n}));function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function v(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function m(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==d(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==d(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===d(o)?o:String(o)),r)}var o}var p=function(){function t(e,n,r,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvasWidth=r,this.canvasHeight=o,this.boundry=new Array,this.radius=n,this.numberOfVertices=0,this.constant=2*Math.PI/40,this.rings=[],this.ctx=e;for(var i=0;i<=2*Math.PI;i+=this.constant)this.boundry[this.numberOfVertices]=new y(Math.cos(i)*this.radius,0,Math.sin(i)*this.radius),this.numberOfVertices++;for(var a=1;a>=-1;a-=2)for(var s=this.constant;s<Math.PI/2;s+=this.constant)for(var c=Math.cos(s)*this.radius,l=Math.sin(s)*this.radius*a,u=0;u<6.28;u+=this.constant)this.boundry[this.numberOfVertices]=new y(Math.cos(u)*c,l,Math.sin(u)*c),this.numberOfVertices++;var h=this.boundry[0].trueY,f=this.boundry[0],d=0,v=0;this.rings[0]=new Array;for(var g=0;g<this.numberOfVertices;g++)this.boundry[g].trueY!=h?(h=this.boundry[g].trueY,f=this.boundry[g],d++,v=0,this.rings[d]=new Array,this.rings[d][v]=f,v++):(this.rings[d][v]=this.boundry[g],v++);for(var m=0;m<this.rings.length;m++)for(var p=0;p<this.rings.length-m-1;p++)if(this.rings[p][0].trueY>this.rings[p+1][0].trueY){var b=this.rings[p];this.rings[p]=this.rings[p+1],this.rings[p+1]=b}}var e,n;return e=t,n=[{key:"drawSphere",value:function(t,e){for(var n=this.ctx,r=this.rings[0],o=this.canvasWidth,i=this.canvasHeight,a=new Array(this.rings.length),s=128/this.rings.length,c=0;c<this.rings.length;c++)if(e){for(var l=0,u=Math.round(s*c);u<Math.round(s*(c+1));u++)l+=t[u];l/=Math.round(s*(c+1))-Math.round(s*c),a[c]=l/255/2+1}else a[c]=1;n.lineWidth=3;for(var h=0;h<this.rings.length;h++,r=this.rings[h]){n.moveTo(o/2+r[0].x*a[0],i/2-r[0].y*a[0]),n.beginPath();for(var f=0;f<r.length;f++)n.lineTo(o/2+r[f].x*a[h],i/2-r[f].y*a[h]);n.strokeStyle="rgb(".concat(Math.floor(54.3+16.7*Math.pow(a[h],6)),", ").concat(Math.floor(2*Math.pow(a[h],11.96)),", ").concat(Math.floor(255),")"),n.closePath(),n.stroke()}r=this.rings[0];for(var y=0;y<this.rings.length;y++,r=this.rings[y]){var d=-1,v=!1;if(n.strokeStyle="rgb(".concat(Math.floor(220+10*Math.pow(a[y],3.1)),", ").concat(Math.floor(5+5*Math.pow(a[y],9.65)),", ").concat(Math.floor(5+5*Math.pow(a[y],9.65)),")"),r[0].z>=0&&r[r.length-1].z<0)d=r.length-1;else{for(var g=1;g<r.length;g++)if(r[g].z>=0&&r[g-1].z<0){d=g-1;break}-1==d&&(d=r.length-1,v=!0)}var m;m=0==d?this.slerp(r[0],r[r.length-1]):this.slerp(r[d],r[d-1]),n.moveTo(o/2+m.x*a[y],i/2-m.y*a[y]),n.beginPath(),n.lineTo(o/2+r[d].x*a[y],i/2-r[d].y*a[y]);for(var p=d+1;p!=d&&!(v&&r[0].z<0);p++){if(p>=r.length&&(p=0,r[r.length-1].z>=0&&r[0].z<0)){var b=this.slerp(r[0],r[r.length-1]);n.lineTo(o/2+b.x*a[y],i/2-b.y*a[y]),n.stroke();break}if(0==d&&0==p)break;if(v)n.lineTo(o/2+r[p].x*a[y],i/2-r[p].y*a[y]);else{if(r[p].z<0&&p-1!=-1&&r[p-1].z>=0){if(n.lineTo(o/2+r[p].x*a[y],i/2-r[p].y*a[y]),p+1==r.length){var w=this.slerp(r[p],r[r.length-1]);n.lineTo(o/2+w.x*a[y],i/2-w.y*a[y])}else{var S=this.slerp(r[p-1],r[p]);n.lineTo(o/2+S.x*a[y],i/2-S.y*a[y])}n.stroke();break}if(0==p&&r[p].z<0&&r[r.length-1]>=0){var M=this.slerp(r[p],r[p-1]);n.lineTo(o/2+M.x*a[y],i/2-M.y*a[y]),n.stroke()}else if(n.lineTo(o/2+r[p].x*a[y],i/2-r[p].y*a[y]),p+1==d){var k=this.slerp(r[p],r[d]);n.lineTo(o/2+k.x*a[y],i/2-k.y*a[y]),n.stroke()}else if(p+1>=r.length&&0==d){var T=this.slerp(r[p],r[0]);n.lineTo(o/2+T.x*a[y],i/2-T.y*a[y]),n.stroke()}}}v&&r[d].z>=0&&(n.closePath(),n.stroke())}}},{key:"rotateX",value:function(t){t=this.rdt(t);var e,n=v(this.boundry);try{for(n.s();!(e=n.n()).done;){var r=e.value,o=r.y;r.y=o*Math.cos(t)+r.z*Math.sin(t)*-1,r.z=o*Math.sin(t)+r.z*Math.cos(t)}}catch(t){n.e(t)}finally{n.f()}}},{key:"rotateY",value:function(t){t=this.rdt(t);var e,n=v(this.boundry);try{for(n.s();!(e=n.n()).done;){var r=e.value,o=r.x;r.x=o*Math.cos(t)+r.z*Math.sin(t)*-1,r.z=o*Math.sin(t)+r.z*Math.cos(t)}}catch(t){n.e(t)}finally{n.f()}}},{key:"rotateZ",value:function(t){t=this.rdt(t);var e,n=v(this.boundry);try{for(n.s();!(e=n.n()).done;){var r=e.value,o=r.x;r.x=o*Math.cos(t)+r.y*Math.sin(t)*-1,r.y=o*Math.sin(t)+r.y*Math.cos(t)}}catch(t){n.e(t)}finally{n.f()}}},{key:"rdt",value:function(t){return t*(Math.PI/180)}},{key:"slerp",value:function(t,e){var n=[t.x/this.radius,t.y/this.radius,t.z/this.radius],r=[e.x/this.radius,e.y/this.radius,e.z/this.radius],o=Math.acos(n[0]*r[0]+n[1]*r[1]+n[2]*r[2]),i=-n[2]/(r[2]-n[2]),a=Math.sin((1-i)*o),s=Math.sin(i*o);return new y((a/Math.sin(o)*n[0]+s/Math.sin(o)*r[0])*this.radius,(a/Math.sin(o)*n[1]+s/Math.sin(o)*r[1])*this.radius,0)}}],n&&m(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function w(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==b(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==b(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===b(o)?o:String(o)),r)}var o}var S,M,k,T,q,x,A,z,P,I,j,C,O=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=Math.random()*e,this.y=Math.random()*n,this.size=3*Math.random(),this.angle=2*Math.random()*Math.PI,this.velocity=Math.pow(this.size,2)/4,this.canvasWidth=e,this.canvasHeight=n}var e,n;return e=t,n=[{key:"update",value:function(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];e=e/t.length/255*2.5+1,this.x+=this.velocity*e*Math.cos(this.angle),this.y+=this.velocity*e*Math.sin(this.angle),this.angle+=20*Math.random()*Math.PI/180-10*Math.PI/180,this.angle<0&&(this.angle+=Math.PI/12),this.angle>Math.PI&&(this.angle-=Math.PI/12),this.x>this.canvasWidth+15&&(this.x=-5),this.x<-15&&(this.x=this.canvasWidth+5),this.y>this.canvasHeight+15&&(this.y=-5)}},{key:"draw",value:function(t,e){for(var n=0,r=0;r<e.length;r++)n+=e[r];n=n/e.length/255*1.25+1,t.beginPath(),t.arc(this.x,this.y,this.size*n,0,2*Math.PI),t.fillStyle="#fddba3",t.fill()}}],n&&w(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),E=function(e,n){S=e.getContext("2d"),M=e.width,k=e.height,T=function(e,n,r,o,i,a){var s,c=e.createLinearGradient(0,0,0,i),l=function(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var t=r.next();return s=t.done,t},e:function(t){c=!0,a=t},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}([{percent:0,color:"aqua"},{percent:1,color:"magenta"}]);try{for(l.s();!(s=l.n()).done;){var u=s.value;c.addColorStop(u.percent,u.color)}}catch(t){l.e(t)}finally{l.f()}return c}(S,0,0,0,k),q=n,x=new Uint8Array(q.fftSize/2),(A=new p(S,100,M,k)).rotateX(30),A.rotateY(10),C=new Array(30);for(var r=0;r<C.length;r++)C[r]=new O(M,k);z=(new Date).getTime(),P=0,I=0,j=new Array(128);for(var o=0;o<j.length;o++)j[o]=0},F={},B=Object.freeze({sound1:"media/new_adventure_theme.mp3"}),V=function(){var t,u,h;console.log("init called"),console.log("Testing utils.getRandomColor() import: ".concat("rgba(".concat((h=function(){return 185*Math.random()+35})(),",").concat(h(),",").concat(h(),",1)"))),t=B.sound1,u=window.AudioContext||window.webkitAudioContext,e=new u,n=new Audio,l(t),r=e.createMediaElementSource(n),(a=e.createBiquadFilter()).type="highshelf",(s=e.createBiquadFilter()).type="lowshelf",(o=e.createAnalyser()).fftSize=c.numSamples,r.connect(a),a.connect(s),s.connect(o),(i=e.createGain()).gain.value=c.gain,r.connect(o),o.connect(i),i.connect(e.destination);var f=document.querySelector("canvas");R(f),E(f,o);var y=new XMLHttpRequest;y.onload=function(t){console.log("In onload - HTTP Status Code = ".concat(t.target.status));var e=t.target.responseText,n=JSON.parse(e).drawParams;Object.assign(F,n);var r=JSON.parse(e),o=document.createElement("h1");o.textContent=r.Title,document.body.insertBefore(o,document.body.firstChild);for(var i=document.getElementById("track-select"),a=0;a<r.Songs.length;a++){var s=r.Songs[a],c=document.createElement("option");c.value=s.location,c.textContent=s.title,0===a&&(c.selected=!0),i.appendChild(c)}},y.onerror=function(t){return console.log("In onerrer - HTTP Status Code = ".concat(t.target.status))},y.open("GET","./data/av-data.json"),y.send(),W()},R=function(t){document.querySelector("#fs-button").onclick=function(e){var n;console.log("init called"),(n=t).requestFullscreen?n.requestFullscreen():n.mozRequestFullscreen?n.mozRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()};var r=document.querySelector("#play-button");r.onclick=function(t){console.log("audioCtx.state before = ".concat(e.state)),"suspended"==e.state&&e.resume(),console.log("audioCtx.state after = ".concat(e.state)),"no"==t.target.dataset.playing?(n.play(),t.target.dataset.playing="yes"):(n.pause(),t.target.dataset.playing="no")};var o=document.querySelector("#volume-slider"),c=document.querySelector("#volume-label");o.oninput=function(t){var e;e=t.target.value,e=Number(e),i.gain.value=e,c.innerHTML=Math.round(t.target.value/2*100)},o.dispatchEvent(new Event("input")),document.querySelector("#track-select").onchange=function(t){l(t.target.value),"yes"==r.dataset.playing&&r.dispatchEvent(new MouseEvent("click"))};var u=document.querySelector("#gradient-cb"),h=document.querySelector("#bars-cb"),f=document.querySelector("#sphere-cb"),y=document.querySelector("#pulse-sphere-cb"),d=document.querySelector("#spin-sphere-cb"),v=document.querySelector("#confetti-cb"),g=document.querySelector("#noise-cb"),m=document.querySelector("#invert-cb"),p=document.querySelector("#emboss-cb"),b=document.querySelector("#highshelf-cb"),w=document.querySelector("#lowshelf-cb"),S=document.querySelector("#frequency"),M=document.querySelector("#waveform");u.onclick=function(t){t.target.checked?F.showGradient=!0:F.showGradient=!1},h.onclick=function(t){t.target.checked?F.showBars=!0:F.showBars=!1},f.onclick=function(t){t.target.checked?F.showSphere=!0:F.showSphere=!1},y.onclick=function(t){t.target.checked?F.pulseSphere=!0:F.pulseSphere=!1},d.onclick=function(t){t.target.checked?F.spinSphere=!0:F.spinSphere=!1},v.onclick=function(t){t.target.checked?F.showConfetti=!0:F.showConfetti=!1},g.onclick=function(t){t.target.checked?F.showNoise=!0:F.showNoise=!1},m.onclick=function(t){t.target.checked?F.showInvert=!0:F.showInvert=!1},p.onclick=function(t){t.target.checked?F.showEmboss=!0:F.showEmboss=!1},b.onclick=function(t){t.target.checked?(F.useTreble=!0,a.frequency.setValueAtTime(1e3,e.currentTime),a.gain.setValueAtTime(15,e.currentTime)):(F.useTreble=!1,a.gain.setValueAtTime(0,e.currentTime))},w.onclick=function(t){t.target.checked?(F.useBase=!0,s.frequency.setValueAtTime(1e3,e.currentTime),s.gain.setValueAtTime(30,e.currentTime)):(F.useBase=!1,s.gain.setValueAtTime(0,e.currentTime))},S.onclick=function(){F.displayFrequency=!0,F.displayWaveform=!1},M.onclick=function(){F.displayFrequency=!1,F.displayWaveform=!0}},W=function t(){setTimeout((function(){requestAnimationFrame(t)}),1e3/60),function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(P=(new Date).getTime(),I=(P-z)/1e3,t.displayFrequency&&(q.getByteFrequencyData(x),j=x),t.displayWaveform){q.getByteTimeDomainData(x);for(var e=0;e<128;e++)j[e]=(j[e]+x[e])/2}if(S.save(),S.fillStyle="black",S.globalAlpha=1,S.fillRect(0,0,M,k),S.restore(),t.showGradient&&(S.save(),S.fillStyle=T,S.globalAlpha=1,S.fillRect(0,0,M,k),S.restore()),t.showConfetti)for(var n=0;n<C.length;n++)C[n].update(j),C[n].draw(S,j);if(t.showBars){S.save();for(var r=q.frequencyBinCount,o=M/128-.5,i=0,a=0,s=0;s<r;s++)i=j[s]*(.002*k),S.fillStyle="rgba(255, 255, 255, 0.5)",S.fillRect(a,k/2-i+i/2,o,i),a+=o+.5,S.restore()}if(t.showSphere){if(S.save(),t.pulseSphere?A.drawSphere(j,!0):A.drawSphere(j,!1),t.spinSphere){for(var c=0,l=0,u=0,h=0;h<43;h++)c+=j[h];for(var f=43;f<85;f++)l+=j[f];for(var y=86;y<128;y++)u+=j[y];0!=c&&(c=(c-128)/44),0!=l&&(l=(l-90)/43),0!=u&&(u=(u-50)/43),A.rotateX(c*I),A.rotateY(l*I),A.rotateZ(u*I)}S.restore()}for(var d=S.getImageData(0,0,M,k),v=d.data,g=v.length,m=d.width,p=0;p<g;p+=4)if(t.showNoise&&Math.random()<.05&&(v[p]=v[p+1]=v[p+2]=0,v[p+1]=130),t.showInvert){var b=v[p],w=v[p+1],O=v[p+2];v[p]=255-b,v[p+1]=255-w,v[p+2]=255-O}if(t.showEmboss)for(var E=0;E<g;E++)E%4!=3&&(v[E]=127+2*v[E]-v[E+4]-v[E+4*m]);S.putImageData(d,0,0),z=P}(F)};window.onload=function(){console.log("window.onload called"),V()}})();